function showPreview(e){if($("#x").val(e.x),$("#y").val(e.y),$("#w").val(e.w),$("#h").val(e.h),parseInt(e.w)>0){var t=$("#pre-big").width()/e.w,i=$("#pre-big").height()/e.h;$("#crop-pre-big").css({width:Math.round(t*$("#upload-img").width())+"px",height:Math.round(i*$("#upload-img").height())+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(i*e.y)+"px"});var n=$("#pre-middle").width()/e.w,a=$("#pre-middle").height()/e.h;$("#crop-pre-middle").css({width:Math.round(n*$("#upload-img").width())+"px",height:Math.round(a*$("#upload-img").height())+"px",marginLeft:"-"+Math.round(n*e.x)+"px",marginTop:"-"+Math.round(a*e.y)+"px"});var o=$("#pre-small").width()/e.w,r=$("#pre-small").height()/e.h;$("#crop-pre-small").css({width:Math.round(o*$("#upload-img").width())+"px",height:Math.round(r*$("#upload-img").height())+"px",marginLeft:"-"+Math.round(o*e.x)+"px",marginTop:"-"+Math.round(r*e.y)+"px"})}}var selfInfoSave=document.getElementById("self-info-save"),province=document.getElementById("province-select"),citySelect=document.getElementById("city-select"),area=document.getElementById("area-select"),userImgUpload=document.getElementById("user-img-upload");EventUtil.addHandler(userImgUpload,"change",function(e){var t=new FormData;t.append("file",this.files[0]),ajax("post","userSet/imgupload",null,t,function(e){var t="<div class='img-wrap'><div class='upload-origin'><img id='upload-img' src="+JSON.parse(e).img+"></img></div><div class='pre-img'><span id='pre-big'><img id='crop-pre-big' src="+JSON.parse(e).img+"></span><span id='pre-middle'><img id='crop-pre-middle' src="+JSON.parse(e).img+"></span><span id='pre-small'><img id='crop-pre-small' src="+JSON.parse(e).img+"></span></div><input type='hidden' id='x' name='x' /><input type='hidden' id='y' name='y' /><input type='hidden' id='w' name='w' /><input type='hidden' id='h' name='h' />",i=document.querySelector(".p2"),n=Popuper({wrap:i,type:"success",cancel:function(){alert("cancel callback")}}).edit({title:"头像上传",content:t}).show();n.toggle().edit({type:"info"}),$("#upload-img").on("load",function(){var e=$.Jcrop("#upload-img",{boxWidth:300,boxHeight:300,onChange:showPreview,onSelect:showPreview});e.setSelect([$("#upload-img").width()>$("#upload-img").height()?.5*($("#upload-img").width()-$("#upload-img").height()):0,$("#upload-img").width()>$("#upload-img").height()?0:.5*($("#upload-img").height()-$("#upload-img").width()),$("#upload-img").width()>$("#upload-img").height()?.5*($("#upload-img").width()+$("#upload-img").height()):$("#upload-img").height(),$("#upload-img").width()>$("#upload-img").height()?$("#upload-img").height():.5*($("#upload-img").height()+$("#upload-img").width())])})})}),$("#crop-form").submit(function(e){e.preventDefault()}),$("#upload-submit").on("click",function(e){e.stopPropagation(),$(".p2").css("display","none"),$.ajax({url:"/upload/imgupload/size",type:"POST",data:$("#crop-form").serialize(),success:function(e){console.log(e),$("#user-img-show").prop("src",e.bigimg),$(".user-small-img").prop("src",e.smallimg),console.log($("#user-img-show"))}})}),EventUtil.addHandler(province,"change",function(e){var e=EventUtil.getEvent(e),t=(EventUtil.getTarget(e),province.value),i={};i.province=t;var n=citySelect.getElementsByTagName("option");citySelect.innerHTML="<option>请输入城市</option>",area.innerHTML="<option>请输入县区</option>",console.log(n),ajax("post","user/info/city","application/json",JSON.stringify(i),function(e){e=JSON.parse(e);var t=document.createDocumentFragment();for(var i in e){console.log(e[i]);var n=document.createElement("option");n.innerHTML=e[i].city_name,t.appendChild(n)}citySelect.appendChild(t)})}),EventUtil.addHandler(citySelect,"change",function(e){var e=EventUtil.getEvent(e),t=(EventUtil.getTarget(e),province.value),i=citySelect.value,n={};n.province=t,n.city=i,console.log(n);area.getElementsByTagName("option");area.innerHTML="<option>请输入县区</option>",ajax("post","user/info/area","application/json",JSON.stringify(n),function(e){e=JSON.parse(e);var t=document.createDocumentFragment();for(var i in e){console.log(e[i]);var n=document.createElement("option");n.innerHTML=e[i].county_name,t.appendChild(n)}area.appendChild(t)})}),EventUtil.addHandler(selfInfoSave,"click",function(e){var e=EventUtil.getEvent(e);EventUtil.preventDefault(e);for(var t=(EventUtil.getTarget(e),document.getElementById("info-form")),i=seriPost(t),n={},a=0;a<i.length;a++){var o=i[a].split("=");n[o[0]]=o[1]}console.log(JSON.stringify(n)),ajax("post","user/info","application/json",JSON.stringify(n),function(e){alert("设置成功"),console.log(e)})});var verifybox=document.getElementById("verifyBox"),email=verifybox.querySelectorAll("span")[0],mailVerify=document.getElementById("js-verify");EventUtil.addHandler(mailVerify,"click",function(e){var e=EventUtil.getEvent(e);EventUtil.preventDefault(e);var t=email.innerHTML,i={email:t},n=JSON.stringify(i);console.log(n),ajax("post","user/info/email","application/json",n,function(e){console.log(e)})});var reset=document.getElementsByClassName("reset-inp"),resetTip=document.getElementsByClassName("reset-tip-wrap"),setResult={old:!1,"new":!1,renew:!1};console.log(reset[0]),EventUtil.addHandler(reset[0],"blur",function(e){var e=EventUtil.getEvent(e);EventUtil.preventDefault(e);var t=reset[0].value,i={password:t},n=JSON.stringify(i);ajax("post","user/info/oldpw","application/json",n,function(e){"密码正确"==e?(resetTip[0].innerHTML=e,resetTip[0].style.color="green",setResult.old=!0):"密码不正确"==e?(resetTip[0].innerHTML="密码格式正确",resetTip[0].style.color="red",setResult.old=!1):(console.log(e),alert("修改成功"))})}),EventUtil.addHandler(reset[1],"blur",function(e){var t=reset[1].value;t.match(/^[a-zA-Z0-9]{6,16}$/)?(resetTip[1].innerHTML="密码格式正确",resetTip[1].style.color="green",setResult["new"]=!0):(resetTip[1].innerHTML="请输入6到16位字符且只能为数字和字母",resetTip[1].style.color="red",setResult["new"]=!1)}),EventUtil.addHandler(reset[2],"blur",function(e){var e=EventUtil.getEvent(e);EventUtil.preventDefault(e),reset[1].value==reset[2].value?(resetTip[2].innerHTML="输入正确",resetTip[2].style.color="green",setResult.renew=!0):(resetTip[2].innerHTML="两次密码输入不一致",resetTip[2].style.color="red",setResult.renew=!1)});var save=document.getElementById("resetpw-btn-save");EventUtil.addHandler(save,"click",function(e){var e=EventUtil.getEvent(e);EventUtil.preventDefault(e);var t=reset[1].value,i={newpw:t},n=JSON.stringify(i);ajax("post","user/info/newpw","application/json",n,function(e){console.log(e)})});